<!DOCTYPE html>
<html>
<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
-->
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.9.3"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>milupHPC: Postprocessing</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
	<!-- Add icon library -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Add font awesome icons -->
	<!--HIGHLIGHT.JS INSTALL BEGIN
	<link rel="stylesheet" href="github.min.css">
	<script src="highlight.js"></script>
	<script>
		$(function() {
			hljs.configure({useBR: false});
			$(".fragment").each(function(i,node) {
				$(node).removeClass("fragment");
				hljs.highlightBlock(node);
			});
		});
	</script>
	HIGHLIGHT.JS INSTALL END-->
</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				milupHPC documentation <!-- Postprocessing -->
			</span>
			<!-- <span class="search">
				<input type="text" placeholder="Search" onkeydown="search(this,event);">
			</span> -->
		</div>
    <!--
	<div class="icon-bar">
		<a href="https://www.tat.physik.uni-tuebingen.de/~schaefer/#codes" class="fa fa-university"></a>
		<a href="https://github.com/MichaelSt98/milupHPC" class="fa fa-github"></a>
		<a href="https://en.wikipedia.org/wiki/Smoothed-particle_hydrodynamics" class="fa fa-wikipedia-w"></a>
	</div>
	</div>
	-->
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Postprocessing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>Scripts for postprocessing, visualization, ...</b></p>
<h1><a class="anchor" id="autotoc_md65"></a>
Snippets</h1>
<ul>
<li>reading the particle output files</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">import</span> h5py</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line">h5file = <span class="stringliteral">&quot;sample.h5&quot;</span></div>
<div class="line">f = h5py.File(h5file, <span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line"> </div>
<div class="line">mass = f[<span class="stringliteral">&quot;m&quot;</span>][:]</div>
<div class="line">pos = f[<span class="stringliteral">&quot;x&quot;</span>][:] <span class="comment"># x, y, z component</span></div>
<div class="line">vel = f[<span class="stringliteral">&quot;v&quot;</span>][:] <span class="comment"># x, y, z component</span></div>
<div class="line">COM = f[<span class="stringliteral">&quot;COM&quot;</span>][:] <span class="comment"># x, y, z component</span></div>
<div class="line">key = f[<span class="stringliteral">&quot;key&quot;</span>][:] <span class="comment"># SFC key</span></div>
<div class="line">proc = f[<span class="stringliteral">&quot;proc&quot;</span>][:]</div>
<div class="line">time = f[<span class="stringliteral">&quot;time&quot;</span>][:]</div>
<div class="line"><span class="comment"># ...</span></div>
</div><!-- fragment --><ul>
<li>reading the performance files</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">import</span> h5py</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line">h5file = <span class="stringliteral">&quot;sample.h5&quot;</span></div>
<div class="line">f = h5py.File(h5file, <span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line">keys = f[<span class="stringliteral">&#39;time&#39;</span>].keys()</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> key <span class="keywordflow">in</span> keys:</div>
<div class="line">        <span class="comment"># e.g. average for each entry/key</span></div>
<div class="line">        elapsed = np.array(f[<span class="stringliteral">&quot;time/{}&quot;</span>.format(key)][:])</div>
<div class="line">        elapsed_max = [np.array(elem).<a class="code hl_function" href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">max</a>() <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> elapsed]</div>
<div class="line">        mean_elapsed = np.array(elapsed_max).mean()</div>
<div class="line">        print(<span class="stringliteral">&quot;{}: {} ms&quot;</span>.format(key, mean_elapsed))</div>
<div class="ttc" id="anamespacecuda_1_1math_html_ae45b7a0e96687aa98c58a3ee386b2ada"><div class="ttname"><a href="namespacecuda_1_1math.html#ae45b7a0e96687aa98c58a3ee386b2ada">cuda::math::max</a></div><div class="ttdeci">__device__ real max(real a, real b)</div><div class="ttdoc">Maximum value out of two floating point values.</div><div class="ttdef"><b>Definition:</b> <a href="cuda__utilities_8cu_source.html#l00431">cuda_utilities.cu:431</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md66"></a>
Paraview</h1>
<ul>
<li><a href="https://www.paraview.org/">ParaView</a></li>
</ul>
<p >ParaView is an open-source, multi-platform data analysis and visualization application. ParaView users can quickly build visualizations to analyze their data using qualitative and quantitative techniques. The data exploration can be done interactively in 3D or programmatically using ParaViewâ€™s batch processing capabilities.</p>
<p >Create a XDMF file in order to facilitate the data access for Paraview:</p>
<div class="fragment"><div class="line"><span class="comment">#!/usr/bin/env python3</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> h5py</div>
<div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> argparse</div>
<div class="line"> </div>
<div class="line">parser = argparse.ArgumentParser(description=<span class="stringliteral">&#39;Generate xdmf file from .h5 miluph output files for paraview postprocessing.\n Open the generated .xdmf file with paraview.&#39;</span>)</div>
<div class="line"> </div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--output&#39;</span>, help=<span class="stringliteral">&#39;output file name&#39;</span>, default=<span class="stringliteral">&#39;paraview.xdmf&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--dim&#39;</span>, help=<span class="stringliteral">&#39;dimension&#39;</span>, default=<span class="stringliteral">&#39;3&#39;</span>)</div>
<div class="line">parser.add_argument(<span class="stringliteral">&#39;--input_files&#39;</span>, nargs=<span class="stringliteral">&#39;+&#39;</span>, help=<span class="stringliteral">&#39;input file names&#39;</span>, default=<span class="stringliteral">&#39;none&#39;</span>)</div>
<div class="line"> </div>
<div class="line">args = parser.parse_args()</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> len(sys.argv) &lt; 3:</div>
<div class="line">    print(<span class="stringliteral">&quot;Try --help to get a usage.&quot;</span>)</div>
<div class="line">    sys.exit(0);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>write_xdmf_header(fh):</div>
<div class="line">    header = <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">&lt;Xdmf&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;Domain Name=&quot;MSI&quot;&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;Grid Name=&quot;CellTime&quot; GridType=&quot;Collection&quot; CollectionType=&quot;Temporal&quot;&gt;</span></div>
<div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line">    fh.write(header)</div>
<div class="line">    </div>
<div class="line"><span class="keyword">def </span>write_xdmf_footer(fh):</div>
<div class="line">    footer = <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="stringliteral">&lt;/Grid&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/Domain&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/Xdmf&gt;</span></div>
<div class="line"><span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line">    fh.write(footer)</div>
<div class="line">    </div>
<div class="line">xdmfh = open(args.output, <span class="stringliteral">&#39;w&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># write header of xdmf file</span></div>
<div class="line">write_xdmf_header(xdmfh)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># now process input files</span></div>
<div class="line"><span class="comment"># scalar floats only </span></div>
<div class="line">wanted_attributes = [<span class="stringliteral">&#39;rho&#39;</span>, <span class="stringliteral">&#39;p&#39;</span>, <span class="stringliteral">&#39;sml&#39;</span>, <span class="stringliteral">&#39;noi&#39;</span>, <span class="stringliteral">&#39;e&#39;</span>]</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> hfile <span class="keywordflow">in</span> args.input_files:</div>
<div class="line">    print(<span class="stringliteral">&quot;Processing %s &quot;</span> % hfile)</div>
<div class="line">    <span class="keywordflow">try</span>: </div>
<div class="line">        f = h5py.File(hfile, <span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line">    <span class="keywordflow">except</span> IOError:</div>
<div class="line">        print(<span class="stringliteral">&quot;Cannot open %s, exiting.&quot;</span> % hfile)</div>
<div class="line">        sys.exit(1)</div>
<div class="line"> </div>
<div class="line">    current_time = f[<span class="stringliteral">&#39;time&#39;</span>][...]</div>
<div class="line">    <span class="comment"># write current time entry</span></div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;Grid Name=&quot;particles&quot; GridType=&quot;Uniform&quot;&gt;\n&#39;</span>)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;Time Value=&quot;%s&quot; /&gt;\n&#39;</span> % current_time[0])</div>
<div class="line">    mylen = len(f[<span class="stringliteral">&#39;x&#39;</span>])</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;Topology TopologyType=&quot;Polyvertex&quot; NodesPerElement=&quot;%s&quot;&gt;&lt;/Topology&gt;\n&#39;</span> % mylen)</div>
<div class="line">    <span class="keywordflow">if</span> args.dim == <span class="stringliteral">&#39;3&#39;</span>:</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;Geometry GeometryType=&quot;XYZ&quot;&gt;\n&#39;</span>)</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;DataItem DataType=&quot;Float&quot; Dimensions=&quot;%s 3&quot; Format=&quot;HDF&quot;&gt;\n&#39;</span> % mylen)</div>
<div class="line">    <span class="keywordflow">else</span>:</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;Geometry GeometryType=&quot;XY&quot;&gt;\n&#39;</span>)</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;DataItem DataType=&quot;Float&quot; Dimensions=&quot;%s 2&quot; Format=&quot;HDF&quot;&gt;\n&#39;</span> % mylen)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;%s:/x\n&#39;</span> % hfile) </div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;/DataItem&gt;\n&#39;</span>)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;/Geometry&gt;\n&#39;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># velocities</span></div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;Attribute AttributeType=&quot;Vector&quot; Centor=&quot;Node&quot; Name=&quot;velocity&quot;&gt;\n&#39;</span>)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;DataItem DataType=&quot;Float&quot; Dimensions=&quot;%s %s&quot; Format=&quot;HDF&quot;&gt;\n&#39;</span> % (mylen, args.dim))</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;%s:/v\n&#39;</span> % hfile)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;/DataItem&gt;\n&#39;</span>)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;/Attribute&gt;\n&#39;</span>)</div>
<div class="line"> </div>
<div class="line">    <span class="comment"># wanted_attributes</span></div>
<div class="line">    <span class="keywordflow">for</span> myattr <span class="keywordflow">in</span> wanted_attributes:</div>
<div class="line">        datatype = <span class="stringliteral">&quot;Float&quot;</span></div>
<div class="line">        <span class="keywordflow">if</span> myattr <span class="keywordflow">in</span> [<span class="stringliteral">&#39;number_of_interactions&#39;</span>, <span class="stringliteral">&#39;material_type&#39;</span>]:</div>
<div class="line">            datatype = <span class="stringliteral">&quot;Integer&quot;</span></div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;Attribute AttributeType=&quot;Scalar&quot; Centor=&quot;Node&quot; Name=&quot;%s&quot;&gt;\n&#39;</span> % myattr)</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;DataItem DataType=&quot;%s&quot; Dimensions=&quot;%s 1&quot; Format=&quot;HDF&quot;&gt;\n&#39;</span> % (datatype, mylen))</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;%s:/%s\n&#39;</span> % (hfile, myattr))</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;/DataItem&gt;\n&#39;</span>)</div>
<div class="line">        xdmfh.write(<span class="stringliteral">&#39;&lt;/Attribute&gt;\n&#39;</span>)</div>
<div class="line">    xdmfh.write(<span class="stringliteral">&#39;&lt;/Grid&gt;\n&#39;</span>)</div>
<div class="line">    f.close()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># write footnote of xdmf file</span></div>
<div class="line">write_xdmf_footer(xdmfh)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
Remote Paraview</h2>
<p >The information presented here is based on <a href="https://docs.paraview.org/en/latest/ReferenceManual/parallelDataVisualization.html">https://docs.paraview.org/en/latest/ReferenceManual/parallelDataVisualization.html</a></p>
<ol type="1">
<li>install locally paraview on your laptop and on the server with the identical version.</li>
<li>run the binary pvserver on the server side (it's in the same directory as the paraview binary), e.g. <br  />
 ~/sw/paraview/ParaView-5.8.0-MPI-Linux-Python3.7-64bit/bin/pvserver &ndash;force-offscreen-rendering IMPORTANT: log in to the server via ssh without X forwarding (ssh +X cpt-kamino.am10.uni-tuebingen.de)</li>
<li>start the client on your laptop, go to File-&gt;connect and add cpt-kamino to the server list</li>
<li>if the client connection is successful, you can choose File-&gt;open and open the file on the server. the rendering will be done on the server and the client will display the final picture.</li>
</ol>
<h1><a class="anchor" id="autotoc_md68"></a>
Custom scripts</h1>
<ul>
<li><a href="RhsPerformance.py">RhsPerformance.py</a>: get average execution time for each part of the simulation<ul>
<li>usage: <code>./RhsPerformance -d &lt;HDF5 performance file&gt;</code> <br  />
</li>
</ul>
</li>
<li><a href="PerformanceComparison.py">PerformanceComparison.py</a>: compare average execution time for each part of the simulation<ul>
<li>usage: <code>./RhsPerformance -a &lt;HDF5 performance file 1&gt; -b &lt;HDF5 performance file 2&gt;</code> <br  />
</li>
</ul>
</li>
<li><a href="PlotPlummer.py">PlotPlummer.py</a>: plot mass quantiles for the plummer test case<ul>
<li>usage: e.g. <code>./PlotPlummer.py -Q -d &lt;input data directory&gt; -o &lt;output directory&gt;</code></li>
</ul>
</li>
<li><a href="PlotSedov.py">PlotSedov.py</a>: plot density, pressure and internal energy in dependence of the radius for the sedov test case, including the semi-analytical solution<ul>
<li>usage: e.g. <code>./PlotSedov.py -i &lt;input HDF5 particle file&gt; -o &lt;output directory&gt; -a -p 1</code></li>
<li>for applying script for all output files: e.g. &lsquo;find &lt;directory with input files&gt; -type f -name 'ts*.h5&rsquo; -print0 | parallel -0 -j 1 ./PlotSedov.py -i {} -o &lt;output directory&gt; -a -p 1 \;<code><ul>
<li>combining those to a video:ffmpeg -r 24 -i &lt;input directory&gt;/ts%06d.h5.png -vf 'pad=ceil(iw/2)*2:ceil(ih/2)*2' -pix_fmt yuv420p -vcodec libx264 -y -an &lt;output directory&gt;/evolution.mp4`</li>
</ul>
</code></li>
</ul>
</li>
<li><code><a href="PlotBB.py">PlotBB.py</a>: plot density evolution (for the isothermal collapse test case)<ul>
<li>usage: <code>PlotBB.py -d &lt;input directory&gt; -o &lt;output directory&gt;</code></li>
</ul>
</code></li>
<li><code><a href="GetMinMaxMean.py">GetMinMaxMean.py</a>: calculate min, max, mean for each entry and each output file and write/summarize to CSV file <br  />
<ul>
<li>usage: <code>./GetMinMaxMean.py -i &lt;input directory&gt; -o &lt;output directory&gt;</code></li>
</ul>
</code></li>
<li><code><a href="PlotMinMaxMean.py">PlotMinMaxMean.py</a>: take min, max, mean CSV file and plot for each entry<ul>
<li>usage: <code>./PlotMinMaxMean.py -i &lt;input directory&gt;/min_max_mean.csv -o &lt;output directory&gt; -a</code></li>
<li>requires previous execution of <code>PlotMinMaxMean.py</code></li>
</ul>
</code></li>
<li><code><a href="VisualizeDistribution.py">VisualizeDistribution.py</a>: visualize a particle distribution with Matplotlib 3D</code></li>
<li><code><a href="VisualizeDomains_2D.py">VisualizeDomains_2D.py</a>: visualize domain borders or rather domains for 2D simulations</code></li>
<li><code><a href="VisualizeDomains_3D.py">VisualizeDomains_3D.py</a>: visualize domain borders or rather domains for 3D simulations </code></li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    milupHPC  - Postprocessing<br />
    Generated on Thu Jun 23 2022 16:11:20 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
  </small></address>
</body>
<footer>
  <button onclick="topFunction()" id="myBtn" title="Go to top">Got to top</button>
  <div id="banner-footer-first"></div>
  <div id="banner-footer-second"></div>
  <script>
    function topFunction() {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
  </script>
</footer>
</html>