<!DOCTYPE html>
<html>
<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
-->
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.9.3"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>milupHPC: milupHPC</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
	<!-- Add icon library -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Add font awesome icons -->
	<!--HIGHLIGHT.JS INSTALL BEGIN
	<link rel="stylesheet" href="github.min.css">
	<script src="highlight.js"></script>
	<script>
		$(function() {
			hljs.configure({useBR: false});
			$(".fragment").each(function(i,node) {
				$(node).removeClass("fragment");
				hljs.highlightBlock(node);
			});
		});
	</script>
	HIGHLIGHT.JS INSTALL END-->
</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				milupHPC documentation <!-- milupHPC -->
			</span>
			<!-- <span class="search">
				<input type="text" placeholder="Search" onkeydown="search(this,event);">
			</span> -->
		</div>
    <!--
	<div class="icon-bar">
		<a href="https://www.tat.physik.uni-tuebingen.de/~schaefer/#codes" class="fa fa-university"></a>
		<a href="https://github.com/MichaelSt98/milupHPC" class="fa fa-github"></a>
		<a href="https://en.wikipedia.org/wiki/Smoothed-particle_hydrodynamics" class="fa fa-wikipedia-w"></a>
	</div>
	</div>
	-->
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">milupHPC </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>High Performance Computing Smooth(ed) Particle Hydrodynamics</b></p>
<p >The successor of <a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a> targeting GPU cluster via CUDA aware MPI.</p>
<hr  />
<p >This repository implements a <b>multi-GPU <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> &amp; N-body (via Barnes-Hut) algorithm using C++11 and CUDA-aware MPI</b> by combining already proven parallelization strategies and available implementations</p>
<ul>
<li><b>single-GPU version inspired/adopted from:</b><ul>
<li><a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a></li>
<li><a href="https://iss.oden.utexas.edu/Publications/Papers/burtscher11.pdf">An Efficient CUDA Implementation of the Tree-Based Barnes Hut n-Body Algorithm</a></li>
</ul>
</li>
<li><b>multi-node (or rather multi-CPU) version inspired/adopted from:</b><ul>
<li>M. Griebel, S. Knapek, and G. Zumbusch. Numerical Simulation in Molecular Dynamics: Numerics, Algorithms, Parallelization, Applications. 1st. Springer Pub- lishing Company, Incorporated, 2010. isbn: 3642087760</li>
</ul>
</li>
</ul>
<p >with new ideas and parallelization strategies.</p>
<ul>
<li>for a <b>versatile single-GPU implementation</b> refer to <a href="https://github.com/christophmschaefer/miluphcuda">miluphcuda</a></li>
<li>for a <b>multi-CPU implementation</b> (self-gravity via Barnes-Hut only) refer to <a href="https://github.com/jammartin/ParaLoBstar">jammartin/ParaLoBstar</a></li>
</ul>
<hr  />
<p ><b>See also:</b></p>
<ul>
<li><b><a href="https://michaelst98.github.io/milupHPC/">milupHPC API documentation</a></b> (Doxygen)</li>
<li><a class="el" href="md_documents__prerequisites.html">Prerequisites.md</a>: for instructions to install the dependencies</li>
<li><a class="el" href="md_documents__compilation.html">Compilation.md</a>: for instructions to compile the code</li>
<li><a class="el" href="md_documents__getting_started.html">GettingStarted.md</a>: for getting started, including running some test cases<ul>
<li><a href="testcases/plummer/">Plummer</a> gravity-only test case (README)</li>
<li><a href="../testcases/sedov/">Taylor-von Neumann-Sedov blast wave</a> SPH-only test case (../testcases/sedov/README.md "README")</li>
</ul>
</li>
<li>Postprocessing.md: for information regarding postprocessing<ul>
<li><a href="../H5Renderer/">H5Renderer</a> for basic rendering (../H5Renderer/README.md "README")</li>
</ul>
</li>
<li>Debugging.md: for information regarding debugging</li>
</ul>
<hr  />
<p ><b>Repository content:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Directory   </th><th class="markdownTableHeadNone"> Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="src/"><b>src/</b></a> &amp; <a href="include/"><b>include/</b></a>   </td><td class="markdownTableBodyNone">**actual multi-GPU <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> &amp; Barnes-Hut implementation**    </td></tr>
</table>
<p>| <b>bin/</b> | binary to be executed, compile via <code>make</code>|  | <b>build/</b> | build files, created by <code>make</code> |  | <a href="debug/"><b>debug/</b></a> | debugging with gdb, lldb, cuda gdb (README) |  | <a href="config/"><b>config/</b></a> | config files for settings (<code>.info</code>) and material parameters (<code>.cfg</code>) (README) |  | <a href="testcases/"><b>testcases/</b></a> | test cases including <a href="testcases/Plummer/">Plummer</a> and <a href="testcases/Sedov/">Sedov</a> (README) | | <a href="cluster/"><b>cluster/</b></a> | information to dispatch simulation on clusters using queing systems (README) |  | <a href="postprocessing/"><b>postprocessing/</b></a> | postprocessing scripts (README) | | <a href="H5Renderer/"><b>H5Renderer/</b></a> | H5Renderer implementation: basic Renderer (2D) (README) | | <a href="utilities/"><b>utilities/</b></a> | utilities e.g. counting lines of code (README) |  | <a href="doc/"><b>doc/</b></a> | create Doxygen documentation (<a class="el" href="md_doc__r_e_a_d_m_e.html">README</a>) |  | <b>documents/</b> | several documents including files for README, instructions, notes, ... |  | <b>images/</b> | images for MD files, ... | </p>
<hr  />
<h1><a class="anchor" id="autotoc_md1"></a>
Parallelization/Implementation</h1>
<ul>
<li>Parallelization embraces both<ul>
<li><b>multi-node</b> parallelization via message-passing (MPI) and</li>
<li><b>single-node</b> parallelization for **GPU**s via CUDA</li>
</ul>
</li>
</ul>
<p >implemented using <b>C++ and CUDA-aware MPI</b>.</p>
<p ><img src="documents/figures/class_miluphpc__coll__graph_small.png" alt="Collaboration diagram" width="100%" class="inline"/></p>
<p ><details>
 <summary> Implementation details </summary></details>
</p>
<p ><details>
</p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"> Directory   </th><th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">**./**   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em>include/</em> &amp; <em>src/</em> directory    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="main_8cpp.html">main.cpp</a></em>   </td><td class="markdownTableBodyNone">main: setting CUDA device, config parsing, loading parameters/settings, integrator selection, start of simulation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *miluphpc.h/cpp*   </td><td class="markdownTableBodyNone"><b>abstract base class</b> defining largest reoccuring part of the simulation (right hand side) and assorted high level functionalities    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="particles_8cuh.html" title="Particle struct as Structure of arrays both instantiable on host and device.">particles.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">particle class (SoA) and reduced particle class: particle attributes like mass, position, velocity, density, ...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="particle__handler_8h.html">particle_handler.h</a>/cpp</em>   </td><td class="markdownTableBodyNone">handler class for particle class including memory allocation and copy mechanisms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="simulation__time_8cuh.html" title="Simulation time related variables and functions instantiable on device and host.">simulation_time.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">simulation time class: start &amp; end time, time step, ...     </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *simulation_time_handler.cpp*   </td><td class="markdownTableBodyNone">handler for simulation time class including memory allocation and copy mechanisms     </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="device__rhs_8cuh.html">device_rhs.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">CUDA kernels for resetting arrays/variables (in between right hand sides)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="helper_8cuh.html">helper.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">buffer class and sorting algorithms (based on CUDA cub)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"> *helper_handler.h/cpp*   </td><td class="markdownTableBodyNone">buffer class handler including memory allocation and copy mechanisms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>subdomain_key_tree/</b>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">(parallel) tree related functionalities including tree construction and domain decomposition     </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="tree_8cuh.html" title="Tree related classes, kernels and functions.">tree.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">(local) tree class and CUDA kernels for tree construction    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="tree__handler_8h.html" title="Tree class handler.">tree_handler.h</a>/cpp</em>   </td><td class="markdownTableBodyNone">(local) tree class handler including memory allocation and kernel execution wrapper     </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *subdomain.cuh/cu*   </td><td class="markdownTableBodyNone">(parallel) tree structures including domain decomposition, SFC keys, ...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *subdomain_handler.h/cpp*   </td><td class="markdownTableBodyNone">(parallel) tree handling including memory allocation and kernel execution     </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>gravity/</b>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">gravity related functionalities according to the <b>Barnes-Hut</b> method     </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="gravity_8cuh.html" title="Gravitational force computation functions and CUDA kernels.">gravity.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">gravity related CUDA kernels according to the Barnes-Hut method    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>sph/</b>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> Smoothed Particle Hydrodynamics (<a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a>) related functionalities    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *kernel.cuh/cu*   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> smoothing kernels    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="kernel__handler_8cuh.html">kernel_handler.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> smoothing kernels wrapper    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *sph.cuh/cu*   </td><td class="markdownTableBodyNone">fixed radius near neighbor search (FRNN) and multi-node <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="density_8cuh.html" title="SPH density calculation.">density.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> density    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *pressure.cuh/cu*   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> pressure    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="soundspeed_8cuh.html" title="Calculating and initializing the speed of sound in dependence of the used equation of state.">soundspeed.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> speed of sound    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *internal_forces.cuh/cu*   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> internal forces    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *stress.cuh/cu*   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> stress (not fully implemented yet)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *viscosity.cuh/cu*   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> viscosity (not fully implemented yet)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>materials/</b>   </td><td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone">material attributes (as needed for <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="material_8cuh.html" title="Material parameters and settings.">material.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">material attributes class    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em>material_handler.cuh/cpp</em>   </td><td class="markdownTableBodyNone">material attributes handler class including loading from *.cfg* file    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>integrator/</b>   </td><td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><b>child classes for miluphpc</b> implementing <code><a class="el" href="namespace_profiler_ids_1_1_time.html#adbe0ef0106f04388430449d555dd1655">integrate()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="device__explicit__euler_8cuh.html" title="Device functions and kernels for the explicit euler integrator.">device_explicit_euler.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">explicit Euler integrator device implementations    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *explicit_euler.h/cpp*   </td><td class="markdownTableBodyNone">explicit Euler integrator logic and flow    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *device_leapfrog.cuh/cu*   </td><td class="markdownTableBodyNone">leapfrog integrator device implementations    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *leapfrog.h/cpp*   </td><td class="markdownTableBodyNone">leapforg integrator logic and flow    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *device_predictor_corrector_euler.cuh/cu*   </td><td class="markdownTableBodyNone">predictor-corrector Euler integrator device implementations    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *predictor_corrector_euler.h/cpp*   </td><td class="markdownTableBodyNone">predictor-corrector Euler integrator logic and flow    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>processing/</b>   </td><td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone">removing particles that moved to far from simulation center, ...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="kernels_8cuh.html" title="...">kernels.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">removing particles that moved to far from simulation center based on a sphere/cuboid    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>utils/</b>   </td><td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone">C++ utilites like config parsing, logging, profiling, timing, ...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="config__parser_8h.html" title="Config parser.">config_parser.h</a>/cpp</em>   </td><td class="markdownTableBodyNone">config parser based on <em>cxxopts</em>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="h5profiler_8h.html" title="profiler based on (parallel) HDF5">h5profiler.h</a>/cpp</em>   </td><td class="markdownTableBodyNone"> HDF5 profiler based on <em>HighFive</em>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *logger.h/cpp*   </td><td class="markdownTableBodyNone"><a class="el" href="class_logger.html" title="Logger class.">Logger</a> class and functionalities (taking MPI ranks into account)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"> *timer.h/cpp*   </td><td class="markdownTableBodyNone"> timing events based on MPI timer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>cuda_utils/</b>   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">CUDA utilities including wrappers, execution policy and math kernels    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="cuda__launcher_8cuh.html" title="CUDA Kernel wrapper execution.">cuda_launcher.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">CUDA <a class="el" href="namespace_kernel.html">Kernel</a> wrapper and execution policy    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">    </td><td class="markdownTableBodyNone"><em><a class="el" href="cuda__runtime_8h.html" title="CUDA runtime functionalities and wrappers.">cuda_runtime.h</a>/cpp</em>   </td><td class="markdownTableBodyNone">thin CUDA API wrapper    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="cuda__utilities_8cuh.html" title="CUDA utilities.">cuda_utilities.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">utilities for CUDA including simple kernels, assertions, ...    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><em><a class="el" href="linalg_8cuh.html" title="Linear algebra CUDA kernels and device functions.">linalg.cuh</a>/cu</em>   </td><td class="markdownTableBodyNone">linear algebra CUDA kernels   </td></tr>
</table>
<p></details>
</p>
<p ><details>
The actual implementation and dispatching of the simulation includes</details>
</p>
<p ><details>
</p><ul>
<li>pre-processing (inititial particle distribution, ...)</li>
<li>preparation tasks like<ul>
<li>initializing the MPI and CUDA environment</li>
<li>reading the initial particle distribution</li>
<li>memory allocation, ...</li>
</ul>
</li>
<li>the actual simulation in dependence of the used integration scheme<ul>
<li>encapsulated in the right-hand-side (as depicted in the following picture) <br  />
</li>
<li>advancing the particles</li>
</ul>
</li>
<li>post-processing</li>
<li>...</li>
</ul>
<p></details>
</p>
<p ><details>
However, as the following suggests, the simulation differs for single and multi-node execution, whereas multi-node execution requires more and more sophisticated functionalities to ensure the correctness of the algorithms.</details>
</p>
<p ><details>
<img src="documents/figures/right-hand-side.png" alt="right-hand-side" width="100%" class="inline"/></details>
</p>
<p ><details>
</details>
</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Prerequisites/Dependencies</h1>
<p >For more information and instructions refer to <a class="el" href="md_documents__prerequisites.html">Prerequisites.md</a></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">library   </th><th class="markdownTableHeadNone">licence   </th><th class="markdownTableHeadNone">usage   </th><th class="markdownTableHeadNone">link    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GNU   </td><td class="markdownTableBodyNone">GPLv3+   </td><td class="markdownTableBodyNone"> compiler   </td><td class="markdownTableBodyNone"><a href="https://www.gnu.org/home.de.html">gnu.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OpenMPI   </td><td class="markdownTableBodyNone">BSD 3-Clause   </td><td class="markdownTableBodyNone">compiler, MPI Implementation   </td><td class="markdownTableBodyNone"><a href="https://www.open-mpi.org/">open-mpi.org</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDA   </td><td class="markdownTableBodyNone">CUDA Toolkit End User License Agreement   </td><td class="markdownTableBodyNone">compiler, CUDA Toolkit and API   </td><td class="markdownTableBodyNone"><a href="https://developer.nvidia.com/">developer.nvidia.com</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"> CUDA cub   </td><td class="markdownTableBodyNone">BSD 3-Clause "New" or "Revised" License   </td><td class="markdownTableBodyNone">device wide parallel primitives   </td><td class="markdownTableBodyNone"><a href="https://github.com/NVIDIA/cub">github.com/NVIDIA/cub</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HDF5   </td><td class="markdownTableBodyNone">HDF5 License (BSD-Style)   </td><td class="markdownTableBodyNone">parallel HDF5 for I/O operations   </td><td class="markdownTableBodyNone"><a href="https://www.hdfgroup.org/solutions/hdf5/">hdf5group.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">HighFive   </td><td class="markdownTableBodyNone">Boost Software License 1.0   </td><td class="markdownTableBodyNone">C++ wrapper for parallel HDF5   </td><td class="markdownTableBodyNone"><a href="https://github.com/BlueBrain/HighFive">github.com/BlueBrain/HighFive</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Boost   </td><td class="markdownTableBodyNone">Boost Software License 1.0   </td><td class="markdownTableBodyNone">config file parsing, C++ wrapper for MPI   </td><td class="markdownTableBodyNone"><a href="https://www.boost.org/">boost.org</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">cxxopts   </td><td class="markdownTableBodyNone">MIT license   </td><td class="markdownTableBodyNone">command line argument parsing   </td><td class="markdownTableBodyNone"><a href="https://github.com/jarro2783/cxxopts">github.com/jarro2783/cxxopts</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libconfig   </td><td class="markdownTableBodyNone">LGPL-2.1   </td><td class="markdownTableBodyNone">material config parsing   </td><td class="markdownTableBodyNone"><a href="http://hyperrealm.github.io/libconfig/">github.io/libconfig</a>   </td></tr>
</table>
<ul>
<li>in general there is no need for the usage of the GNU compiler and OpenMPI as MPI implementation, as long as a proper C++ compiler as well as MPI implementation (CUDA-aware) are available and corresponding changes in the Makefile are done</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Usage</h1>
<ul>
<li>you need to provide an appropriate H5 file as initial (particle) distribution<ul>
<li>see e.g. <a href="https://github.com/MichaelSt98/ParticleDistributor">GitHub: ParticleDistributor</a></li>
</ul>
</li>
<li><b>build/compile</b> using the <em>Makefile</em> via: <code>make</code><ul>
<li>for debug: <code>make debug</code><ul>
<li>using <em>cuda-gdb</em>: <code>./debug/cuda_debug.sh</code></li>
</ul>
</li>
<li>for single-precision: <code>make single-precision</code> (default: double-precision)</li>
</ul>
</li>
<li><b>run</b> via **<code>mpirun -np &lt;np&gt; &lt;binary&gt; -n &lt;#output files&gt; -f &lt;input hdf5 file&gt; -C &lt;config file&gt; -m &lt;material-config&gt;</code>**<ul>
<li><code>&lt;binary&gt;</code> within <code>bin/</code> e.g. <code>bin/runner</code></li>
<li><code>&lt;input hdf5 file&gt;</code>: appropriate HDF5 file as initial (particle) distribution</li>
<li><code>&lt;config file&gt;</code>: configurations</li>
<li><code>&lt;material-config&gt;</code> : material configurations</li>
<li>as well as correct preprocessor directives: <code><a class="el" href="parameter_8h.html" title="Settings via preprocessor directives, typedefs, constants, structs.">include/parameter.h</a></code></li>
</ul>
</li>
<li>clean via: <code>make clean</code>, <code>make cleaner</code></li>
<li>rebuild via: <code>make remake</code> <br  />
</li>
</ul>
<p ><details>
 <summary> Preprocessor directives: <a class="el" href="parameter_8h.html" title="Settings via preprocessor directives, typedefs, constants, structs.">parameter.h</a> </summary></details>
</p>
<p ><details>
</p><ul>
<li>see <code><a class="el" href="parameter_8h.html" title="Settings via preprocessor directives, typedefs, constants, structs.">include/parameter.h</a></code></li>
</ul>
<p></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line"><span class="preprocessor">#define DEBUGGING 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SAFETY_LEVEL 2</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DIM 3</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SI_UNITS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CUBIC_DOMAINS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define GRAVITY_SIM 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPH_SIM 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_ENERGY 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_DENSITY 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define INTEGRATE_SML 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DECOUPLE_SML 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VARIABLE_SML 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SML_CORRECTION 0</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SPH_EQU_VERSION 1</span></div>
</div><!-- fragment --><p> </details>
</p>
<p ><details>
 <summary> Input HDF5 file </summary></details>
</p>
<p ><details>
</p><ul>
<li>for <b>gravity only</b><ul>
<li>provide mass "m", position "x" and velocity "v"</li>
</ul>
</li>
</ul>
<p></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line">GROUP &quot;/&quot; {</div>
<div class="line">   DATASET &quot;m&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;v&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt; ) / ( &lt;num particles&gt; , &lt;dim&gt; ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;x&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt;  ) / (&lt;num particles&gt; , &lt;dim&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p></details>
</p>
<p ><details>
</p><ul>
<li><b>with <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a></b> provide (at least)<ul>
<li>provide mass "m", material identifier "materialId", internal energy "u", position "x" and velocity "v"</li>
</ul>
</li>
</ul>
<p></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line">GROUP &quot;/&quot; {</div>
<div class="line">   DATASET &quot;m&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;materialId&quot; {</div>
<div class="line">      DATATYPE  H5T_STD_I8LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt;  ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;u&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt;  ) / ( &lt;num particles&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;v&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt; ) / ( &lt;num particles&gt; , &lt;dim&gt; ) }</div>
<div class="line">   }</div>
<div class="line">   DATASET &quot;x&quot; {</div>
<div class="line">      DATATYPE  H5T_IEEE_F64LE</div>
<div class="line">      DATASPACE  SIMPLE { ( &lt;num particles&gt; , &lt;dim&gt;  ) / (&lt;num particles&gt; , &lt;dim&gt;  ) }</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p></details>
</p>
<p ><details>
</details>
</p>
<p ><details>
 <summary> Config file </summary></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line">; IO RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; output directory (will be created if it does not exist)</div>
<div class="line">directory bb/</div>
<div class="line"> </div>
<div class="line">; outputRank (-1 corresponds to all)</div>
<div class="line">outputRank -1</div>
<div class="line">; omit logType::TIME for standard output</div>
<div class="line">omitTime true</div>
<div class="line">; create log file (including warnings, errors, ...)</div>
<div class="line">log true</div>
<div class="line">; create performance log</div>
<div class="line">performanceLog true</div>
<div class="line">; write particles to be sent to h5 file</div>
<div class="line">particlesSent2H5 true</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">; INTEGRATOR RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; integrator selection</div>
<div class="line">; explicit euler [0], predictor-corrector euler [1], leapfrog [2]</div>
<div class="line">integrator 1</div>
<div class="line">; initial time step</div>
<div class="line">timeStep 1e-4</div>
<div class="line">; max time step allowed</div>
<div class="line">maxTimeStep 1e-4</div>
<div class="line">; end time for simulation</div>
<div class="line">;timeEnd 6e-2</div>
<div class="line"> </div>
<div class="line">; SIMULATION RELATED</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; space-filling curve selection</div>
<div class="line">; lebesgue [0], hilbert [1]</div>
<div class="line">sfc 1</div>
<div class="line"> </div>
<div class="line">; theta-criterion for Barnes-Hut (approximative gravity)</div>
<div class="line">theta 0.5</div>
<div class="line">; smoothing parameter for gravitational forces</div>
<div class="line">smoothing 2.56e+20</div>
<div class="line"> </div>
<div class="line">; SPH smoothing kernel selection</div>
<div class="line">; spiky [0], cubic spline [1], wendlandc2 [3], wendlandc4 [4], wendlandc6 [5]</div>
<div class="line">smoothingKernel 1</div>
<div class="line"> </div>
<div class="line">; remove particles (corresponding to some criterion)</div>
<div class="line">removeParticles true</div>
<div class="line">; spherically [0], cubic [1]</div>
<div class="line">removeParticlesCriterion 0</div>
<div class="line">; allowed distance to center (0, 0, 0)</div>
<div class="line">removeParticlesDimension 3.6e14</div>
<div class="line"> </div>
<div class="line">; execute load balancing</div>
<div class="line">loadBalancing false</div>
<div class="line">; interval for executing load balancing (every Nth step)</div>
<div class="line">loadBalancingInterval 1</div>
<div class="line"> </div>
<div class="line">; how much memory to allocate (1.0 -&gt; all particles can in principle be on one process)</div>
<div class="line">particleMemoryContingent 1.0</div>
<div class="line"> </div>
<div class="line">; calculate angular momentum (and save to output file)</div>
<div class="line">calculateAngularMomentum true</div>
<div class="line">; calculate (total) energy (and save to output file)</div>
<div class="line">calculateEnergy true</div>
<div class="line">; calculate center of mass (and save to output file)</div>
<div class="line">calculateCenterOfMass false</div>
<div class="line"> </div>
<div class="line">; IMPLEMENTATION SELECTION</div>
<div class="line">; ------------------------------------------------------</div>
<div class="line">; force version for gravity (use [2])</div>
<div class="line">; burtscher [0], burtscher without presorting [1], miluphcuda with presorting [2],</div>
<div class="line">; miluphcuda without presorting [3], miluphcuda shared memory (experimental) [4]</div>
<div class="line">gravityForceVersion 0</div>
<div class="line">; fixed radius NN version for SPH (use [0])</div>
<div class="line">; normal [0], brute-force [1], shared-memory [2], within-box [3]</div>
<div class="line">sphFixedRadiusNNVersion 3</div>
</div><!-- fragment --><p></details>
</p>
<p ><details>
</details>
</p>
<p ><details>
 <summary> <a class="el" href="class_material.html" title="Material parameters.">Material</a> config file </summary></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line">materials = (</div>
<div class="line">{</div>
<div class="line">    ID = 0</div>
<div class="line">    name = &quot;IsothermalGas&quot;</div>
<div class="line">    #sml = 1e12</div>
<div class="line">    sml = 5.2e11</div>
<div class="line">    interactions = 50</div>
<div class="line">    artificial_viscosity = { alpha = 1.0; beta = 2.0; };</div>
<div class="line">    eos = {</div>
<div class="line">        type = 3</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">...</div>
</div><!-- fragment --><p></details>
</p>
<p ><details>
</details>
</p>
<p ><details>
 <summary> Command line arguments </summary></details>
</p>
<p ><details>
</p><ul>
<li><code>./bin/runner -h</code> gives help:</li>
</ul>
<p></details>
</p>
<p ><details>
</p><div class="fragment"><div class="line">Multi-GPU CUDA Barnes-Hut NBody/SPH code</div>
<div class="line">Usage:</div>
<div class="line">  HPC NBody [OPTION...]</div>
<div class="line"> </div>
<div class="line">  -n, --number-output-files arg</div>
<div class="line">                                number of output files (default: 100)</div>
<div class="line">  -t, --max-time-step arg       time step (default: -1.)</div>
<div class="line">  -l, --load-balancing          load balancing</div>
<div class="line">  -L, --load-balancing-interval arg</div>
<div class="line">                                load balancing interval (default: -1)</div>
<div class="line">  -C, --config arg              config file (default: config/config.info)</div>
<div class="line">  -m, --material-config arg     material config file (default: </div>
<div class="line">                                config/material.cfg)</div>
<div class="line">  -c, --curve-type arg          curve type (Lebesgue: 0/Hilbert: 1) </div>
<div class="line">                                (default: -1)</div>
<div class="line">  -f, --input-file arg          File name (default: -)</div>
<div class="line">  -v, --verbosity arg           Verbosity level (default: 0)</div>
<div class="line">  -h, --help                    Show this help</div>
</div><!-- fragment --><p></details>
</p>
<p ><details>
</details>
</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Samples/Validation</h1>
<p >The code validation comprises the correctness of dispatched simulation on one GPU and multiple GPUs, whereas identical simulation on one and multiple GPUs are not mandatorily bitwise-identical. By suitable choice of compiler flags and in dependence of the used architecture this is in principle attainable. However, this is generally not useful to apply for performance reasons and therefore at this point not presupposed. Amongst others, three test cases were used for validating the implementation:</p>
<ul>
<li>the Plummer test case is a gravity-only test case</li>
<li>the Taylor–von Neumann–Sedov blast wave test case is a pure hydrodynamical <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> test case</li>
<li>the isothermal collapse test case self-gravitating <a class="el" href="namespace_s_p_h.html" title="SPH related functions and kernels.">SPH</a> test case utilizing almost all implemented features</li>
</ul>
<blockquote class="doxtable">
<p >&zwj;each color represents a process, thus a GPU </p>
</blockquote>
<p><details>
 <summary> Plummer </summary></details>
</p>
<p ><details>
</p><ul>
<li>refer to <a href="testcases/plummer/">this testcase</a> (README)</li>
<li>Plummer model: four GPUs with dynamic load balancing every 10th step (top: lebesgue, bottom: hilbert)</li>
</ul>
<p></details>
</p>
<p ><details>
<img src="documents/4proc_plummer_dynamic.gif" alt="Plummer sample" width="100%" class="inline"/></details>
</p>
<p ><details>
The Plummer model is a gravity only test case, the distribution is stable over time enabling the validation as shown in the following picture.</details>
</p>
<p ><details>
<img src="documents/figures/long_pl_N10000000_sfc1D_np4_mass_quantiles.png" alt="Plummer sample" width="100%" class="inline"/></details>
</p>
<p ><details>
</details>
</p>
<p ><details>
 <summary> Taylor–von Neumann–Sedov blast wave </summary></details>
</p>
<p ><details>
</p><ul>
<li>refer to <a href="testcases/sedov/">this testcase</a> (README)</li>
<li>Sedov explosion: one and two GPUs</li>
</ul>
<p></details>
</p>
<p ><details>
<img src="documents/sedov_sample_movie.gif" alt="Sedov sample" width="100%" class="inline"/></details>
</p>
<p ><details>
The density in dependence of the radius for t = 0.06 and the semi-analytical solution as comparison.</details>
</p>
<p ><details>
<img src="documents/figures/sedov_N171_sfc1D_np8_density.png" alt="Sedov sample" width="100%" class="inline"/></details>
</p>
<p ><details>
</details>
</p>
<p ><details>
 <summary> Boss-Bodenheimer: Isothermal collapse </summary></details>
</p>
<p ><details>
</p><ul>
<li>Boss-Bodenheimer: isothermal collapse<ul>
<li>one and two GPUs</li>
</ul>
</li>
</ul>
<p></details>
</p>
<p ><details>
<img src="documents/bb_sample_movie.gif" alt="Isothermal collapse sample" width="100%" class="inline"/></details>
</p>
<p ><details>
Contour plot, showing the density at 1.2 x free-fall time.</details>
</p>
<p ><details>
<img src="documents/figures/bb_contour.png" alt="Isothermal collapse sample" width="100%" class="inline"/></details>
</p>
<p ><details>
</details>
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    milupHPC  - milupHPC<br />
    Generated on Wed Aug 31 2022 12:16:53 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.9.3
  </small></address>
</body>
<footer>
  <button onclick="topFunction()" id="myBtn" title="Go to top">Got to top</button>
  <div id="banner-footer-first"></div>
  <div id="banner-footer-second"></div>
  <script>
    function topFunction() {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
  </script>
</footer>
</html>